---
import { ArticleQueries } from '@domain'
import Card from '@components/Card.astro'
import Layout from '@layouts/Layout.astro'
import ShowArticle from '@components/Articles/ShowArticle.astro'
import { match } from 'shulk'

const { db } = Astro.locals.dependencies

const { slug } = Astro.params

const fetchArticleResult = await ArticleQueries(db).fromSlug(slug as string)

const title = fetchArticleResult
	.map((article) => article.title)
	.mapErr(() => 'Error').val

fetchArticleResult.map((article) => console.log(article))

fetchArticleResult.mapErr((err) => console.error(err))
---

<Layout title={title}>
	{
		match(fetchArticleResult).case({
			Err: ({ val: err }) => (
				<Card error>
					{match(err.constructor.name).case({
						NotFound: () => 'Article not found.',
						_otherwise: () => 'An unexpected error has occured.',
					})}
				</Card>
			),
			Ok: ({ val: article }) => <ShowArticle {article} />,
		})
	}
</Layout>
